<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mees Molenaar">
<meta name="dcterms.date" content="2024-01-06">

<title>CabbageMees - Een Minecraft Discord Bot in Rust - Deel 2 - Het Verkennen van Asynchrone Discord Bots in Rust met Behulp van Poise en Tokio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9GMDP6RW3B"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-9GMDP6RW3B', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="CabbageMees - Een Minecraft Discord Bot in Rust - Deel 2 - Het Verkennen van Asynchrone Discord Bots in Rust met Behulp van Poise en Tokio">
<meta property="og:description" content="Rust tools voor een Discord Bot en ChatGPT trucjes.">
<meta property="og:image" content="https://cabbagemees.nl/posts/2024-01-06-Minecraft-Bot-Rust-Deel-2/images/bot-progression.png">
<meta property="og:site_name" content="CabbageMees">
<meta property="og:image:height" content="1024">
<meta property="og:image:width" content="1792">
<meta name="twitter:title" content="CabbageMees - Een Minecraft Discord Bot in Rust - Deel 2 - Het Verkennen van Asynchrone Discord Bots in Rust met Behulp van Poise en Tokio">
<meta name="twitter:description" content="Rust tools voor een Discord Bot en ChatGPT trucjes.">
<meta name="twitter:image" content="https://cabbagemees.nl/posts/2024-01-06-Minecraft-Bot-Rust-Deel-2/images/bot-progression.png">
<meta name="twitter:image-height" content="1024">
<meta name="twitter:image-width" content="1792">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">CabbageMees</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Over Mij</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Mees-Molenaar"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/CabbageMees"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Een Minecraft Discord Bot in Rust - Deel 2 - Het Verkennen van Asynchrone Discord Bots in Rust met Behulp van Poise en Tokio</h1>
            <p class="subtitle lead">Rust tools voor een Discord Bot en ChatGPT trucjes.</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Rust</div>
                <div class="quarto-category">Discord Bot</div>
                <div class="quarto-category">Tokio</div>
                <div class="quarto-category">Poise</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Mees Molenaar </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 6, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">Intro</a></li>
  <li><a href="#het-begrijpen-van-asynchroon-programmeren-in-rust-met-tokio." id="toc-het-begrijpen-van-asynchroon-programmeren-in-rust-met-tokio." class="nav-link" data-scroll-target="#het-begrijpen-van-asynchroon-programmeren-in-rust-met-tokio.">Het begrijpen van asynchroon programmeren in Rust met Tokio.</a></li>
  <li><a href="#het-maken-van-discord-bots-met-poise" id="toc-het-maken-van-discord-bots-met-poise" class="nav-link" data-scroll-target="#het-maken-van-discord-bots-met-poise">Het maken van Discord bots met Poise</a>
  <ul class="collapse">
  <li><a href="#poise-framework" id="toc-poise-framework" class="nav-link" data-scroll-target="#poise-framework">Poise framework</a></li>
  <li><a href="#slash-command" id="toc-slash-command" class="nav-link" data-scroll-target="#slash-command">Slash command</a></li>
  </ul></li>
  <li><a href="#alle-stukjes-bij-elkaar" id="toc-alle-stukjes-bij-elkaar" class="nav-link" data-scroll-target="#alle-stukjes-bij-elkaar">Alle stukjes bij elkaar</a></li>
  <li><a href="#extra-informatie" id="toc-extra-informatie" class="nav-link" data-scroll-target="#extra-informatie">Extra informatie</a></li>
  <li><a href="#python-decorator-en-rust-attribute-vergelijking" id="toc-python-decorator-en-rust-attribute-vergelijking" class="nav-link" data-scroll-target="#python-decorator-en-rust-attribute-vergelijking">Python decorator en Rust attribute vergelijking</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="intro" class="level2">
<h2 class="anchored" data-anchor-id="intro">Intro</h2>
<p>In de <a href="https://cabbagemees.nl/posts/2023-11-29-Minecraft-Bot-Rust-Deel-1/">vorige post</a> ben ik begonnen met het uitleggen van de voor- en nadelen Rust. Daarnaast heb ik besproken hoe je ChatGPT kunt gebruiken om een nieuwe programmeertaal te leren. In deze post ga ik uitleggen hoe je een Discord Bot kunt maken.</p>
<p>Er zijn verschillende <a href="https://crates.io">crates</a> om sneller projecten af te maken omdat deze werk uit handen nemen. Het plan was om voor de Discord bot <a href="https://github.com/serenity-rs/serenity">Serenity</a> en <a href="https://github.com/shuttle-hq/shuttle">Shuttle</a> te gaan gebruiken. Maar tijdens het maken van de bot kwam ik erachter dat deze twee crates toch niet de juiste waren.</p>
<p>Uiteindelijk zijn het deze crates geworden: * <a href="https://github.com/serenity-rs/poise">Poise</a> deze crate gebruikt Serenity, dus indirect wordt dat nog wel gebruikt. * <a href="https://tokio.rs">Tokio</a></p>
<p>Ik kwam bij Poise uit omdat die het maken van <a href="https://discord.com/developers/docs/interactions/application-commands#slash-commands">slash-commands</a> eenvoudiger maakt dan Serenity. En ik stopte met het gebruik van Shuttle, nadat ik vastliep op deze fout:</p>
<blockquote class="blockquote">
<p>Runtime error: Failed to verify the version of shuttle-runtime in /Users/meesmolenaar/Brain/Projects/minecraft-recipe-discord-bot/target/debug/minecraft-recipe-discord-bot. Is cargo targeting the correct executable?</p>
</blockquote>
<p>Ik heb veel tijd gespendeerd aan het oplossen van deze fout, maar tot op heden is de oplossing nog niet gevonden. Omdat ik Shuttle niet meer gebruik, had ik wel een andere runtime nodig. Tokio heeft een veel gebruikte en stabiele asynchrone runtime en is daarom gekozen.</p>
</section>
<section id="het-begrijpen-van-asynchroon-programmeren-in-rust-met-tokio." class="level2">
<h2 class="anchored" data-anchor-id="het-begrijpen-van-asynchroon-programmeren-in-rust-met-tokio.">Het begrijpen van asynchroon programmeren in Rust met Tokio.</h2>
<p>Rust heeft een eigen implementatie van asynchroon programmeren ten opzichte van andere programmeertalen. Bijvoorbeeld: Rust heeft geen ingebouwde asynchrone runtime <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Daarentegen heeft Rust wel ingebouwde tools <code>async/.await</code> om asynchrone functies te schrijven die lijken op synchrone functies.</p>
<p>Wanneer je <code>async</code> toevoegt aan een code block of functie dan wordt die code een state machine die de <code>Future</code> trait implementeert. Deze code retourneert ook een <code>Future</code> en je moet deze code dan laten uitvoeren door een excecutor.</p>
<p>Binnen een <code>async</code> functie of codeblok kun je <code>.await</code> gebruiken op een andere <code>Future</code>. Dit instrueert het programma om te wachten tot de <code>Future</code> is voltooid. Een cruciaal kenmerk van <code>.await</code> is dat het de uitvoerende thread niet blokkeert, waardoor de runtime andere taken kan uitvoeren tijdens het wachten. Dit efficiënte gebruik van bronnen maakt Rust bijzonder geschikt voor I/O-intensieve toepassingen en taken met veel gelijktijdige operaties.</p>
<p>Dit voorbeeld (hieronder) demonstreert het gebruik van <code>async</code>/<code>.await</code> in Rust met de Tokio runtime. Het illustreert een belangrijk voordeel van asynchrone programmering: het gelijktijdig uitvoeren van meerdere taken. Terwijl de uitvoering van taak 1 wordt uitgesteld – bijvoorbeeld tijdens het wachten op een netwerkverzoek – kan taak 2 alvast worden uitgevoerd. Dit aspect van asynchroniteit zorgt ervoor dat je programma efficiënt blijft draaien, zelfs wanneer bepaalde operaties vertraging ondervinden.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource rust number-lines code-with-copy"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">use</span> <span class="pp">tokio::time::</span><span class="op">{</span>sleep<span class="op">,</span> Duration<span class="op">};</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="at">#[</span><span class="pp">tokio::</span>main<span class="at">]</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">async</span> <span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="pp">&nbsp;&nbsp;&nbsp;&nbsp;println!</span>(<span class="st">"Taak starten..."</span>)<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>&nbsp;&nbsp;&nbsp;&nbsp;let task1 <span class="op">=</span> <span class="pp">tokio::</span>spawn(my_async_function())<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>&nbsp;&nbsp;&nbsp;&nbsp;let task2 <span class="op">=</span> <span class="pp">tokio::</span>spawn(another_async_function())<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>&nbsp;&nbsp;&nbsp;&nbsp;<span class="co">// Wacht op beide taken om te voltooien</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>&nbsp;&nbsp;&nbsp;&nbsp;task1<span class="op">.</span><span class="kw">await</span><span class="op">.</span>expect(<span class="st">"Taak 1 faalde"</span>)<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>&nbsp;&nbsp;&nbsp;&nbsp;task2<span class="op">.</span><span class="kw">await</span><span class="op">.</span>expect(<span class="st">"Taak 2 faalde"</span>)<span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="pp">&nbsp;&nbsp;&nbsp;&nbsp;println!</span>(<span class="st">"Beide taken voltooid."</span>)<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="op">}</span></span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="kw">async</span> <span class="kw">fn</span> my_async_function() <span class="op">{</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="pp">&nbsp;&nbsp;&nbsp;&nbsp;println!</span>(<span class="st">"Begin van de asynchrone taak 1."</span>)<span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>&nbsp;&nbsp;&nbsp;&nbsp;sleep(<span class="pp">Duration::</span>from_secs(<span class="dv">2</span>))<span class="op">.</span><span class="kw">await</span><span class="op">;</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="pp">&nbsp;&nbsp;&nbsp;&nbsp;println!</span>(<span class="st">"Einde van de asynchrone taak 1."</span>)<span class="op">;</span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="op">}</span></span>
<span id="cb1-19"><a href="#cb1-19"></a></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="kw">async</span> <span class="kw">fn</span> another_async_function() <span class="op">{</span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="pp">&nbsp;&nbsp;&nbsp;&nbsp;println!</span>(<span class="st">"Begin van de asynchrone taak 2."</span>)<span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22"></a>&nbsp;&nbsp;&nbsp;&nbsp;sleep(<span class="pp">Duration::</span>from_secs(<span class="dv">1</span>))<span class="op">.</span><span class="kw">await</span><span class="op">;</span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="pp">&nbsp;&nbsp;&nbsp;&nbsp;println!</span>(<span class="st">"Einde van de asynchrone taak 2."</span>)<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Output:</p>
<pre><code>Taak starten...
Begin van de asynchrone taak 1.
Begin van de asynchrone taak 2.
Einde van de asynchrone taak 2.
Einde van de asynchrone taak 1.
Beide taken voltooid.</code></pre>
</section>
<section id="het-maken-van-discord-bots-met-poise" class="level2">
<h2 class="anchored" data-anchor-id="het-maken-van-discord-bots-met-poise">Het maken van Discord bots met Poise</h2>
<p>Toen ik aan dit project begon, was ik van plan <a href="https://github.com/serenity-rs/serenity">Serenity</a> te gebruiken om een Discord Bot te maken. Dat werkte goed en ik had snel een eerste versie werkend, maar toen ik er een <a href="https://support.discord.com/hc/en-us/articles/1500000368501-Slash-Commands-FAQ#:~:text=Slash%20Commands%20are%20the%20new,command%20right%20the%20first%20time.">slash command</a> van probeerde te maken, bleek dat minder eenvoudig dan verwacht. Gelukkig was ik niet de enige en daarom is de <a href="https://github.com/serenity-rs/poise">Poise</a> crate gemaakt. Onder Poise wordt er nog steeds gebruik gemaakt van Serenity, maar het versimpelt het maken van slash commands enorm. <a href="https://github.com/serenity-rs/poise#poise">Andere features</a> die Poise heeft ingebouwd zijn:</p>
<blockquote class="blockquote">
<ul>
<li>flexible argument parsing: command parameters are defined with normal Rust types and parsed automatically</li>
<li>text commands: commands are agnostic over old text-based commands and slash commands</li>
<li>edit tracking: when user edits their message, automatically update bot response</li>
</ul>
</blockquote>
<p>Vervolgens heb je maar twee dingen nodig om met Poise een Discord Bot te maken, namelijk een <code>Framework</code>en een <code>slash-command</code>.</p>
<section id="poise-framework" class="level3">
<h3 class="anchored" data-anchor-id="poise-framework">Poise framework</h3>
<p>Het Poise Framework is de manier om je bot te laten communiceren met de Discord API. En het gebruikt de Serenity client om een verbinding te maken met Discord. Daarnaast dien je hier de rest van de bot te configureren zoals welke commands je bot heeft.</p>
</section>
<section id="slash-command" class="level3">
<h3 class="anchored" data-anchor-id="slash-command">Slash command</h3>
<p>Een slash-command maak je simpelweg door deze attribute voor je functie te zetten:</p>
<p><code>#[poise::command(slash_command)]</code></p>
<p>Maar wat doet zo een attribuut?</p>
<p>Een Rust attribute is een bijzondere functie, vind ik. Rust attributes zijn namelijk procedural macros (<a href="https://doc.rust-lang.org/reference/procedural-macros.html">proc_macro</a>). En wat een procedural macro zo bijzonder maakt, is dat het code uitvoert tijdens het compileren om zo de code tijdens het compileren aan te passen. Niet alleen Poise gebruikt het met bovenstaande <code>poise::command()</code>, maar ook Tokio maakt gebruik van procedural macros, namelijk voor de <code>main</code> functie. Tokio heeft in de [documentatie] een (mooi) voorbeeld van wat die procedural macro doet:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource rust number-lines code-with-copy"><code class="sourceCode rust"><span id="cb3-1"><a href="#cb3-1"></a><span class="at">#[</span><span class="pp">tokio::</span>main<span class="at">]</span>&nbsp;</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">async</span> <span class="kw">fn</span> main() <span class="op">{</span>&nbsp;</span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="pp">println!</span>(<span class="st">"Hello world"</span>)<span class="op">;</span>&nbsp;</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Wordt:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource rust number-lines code-with-copy"><code class="sourceCode rust"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">fn</span> main() <span class="op">{</span>&nbsp;</span>
<span id="cb4-2"><a href="#cb4-2"></a>    <span class="pp">tokio::runtime::Builder::</span>new_multi_thread()&nbsp;</span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="op">.</span>enable_all()&nbsp;</span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="op">.</span>build()&nbsp;</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="op">.</span>unwrap()&nbsp;</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="op">.</span>block_on(<span class="kw">async</span> <span class="op">{</span>&nbsp;</span>
<span id="cb4-7"><a href="#cb4-7"></a>        <span class="pp">println!</span>(<span class="st">"Hello world"</span>)<span class="op">;</span>&nbsp;</span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="op">}</span>)&nbsp;</span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Hier zie je duidelijk dat een procedural macro de code direct verandert (zie onderaan de post, ter vergelijking, wat een Python decorator doet).</p>
</section>
</section>
<section id="alle-stukjes-bij-elkaar" class="level2">
<h2 class="anchored" data-anchor-id="alle-stukjes-bij-elkaar">Alle stukjes bij elkaar</h2>
<p>Nu alle puzzelstukjes zijn gesorteerd, kan de puzzel gelegd worden. Hieronder is een voorbeeld van een simpele, maar complete “hallo” Discord bot. Voel je vrij om de naam van de slash command aan te passen naar wat je maar wilt!</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource rust number-lines code-with-copy"><code class="sourceCode rust"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">use</span> <span class="pp">poise::</span>serenity_prelude <span class="kw">as</span> serenity<span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw">struct</span> Data <span class="op">{}</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="kw">type</span> Error <span class="op">=</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span> <span class="op">+</span> <span class="bu">Send</span> <span class="op">+</span> <span class="bu">Sync</span><span class="op">&gt;;</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="kw">type</span> Context<span class="op">&lt;</span><span class="ot">'a</span><span class="op">&gt;</span> <span class="op">=</span> <span class="pp">poise::</span>Context<span class="op">&lt;</span><span class="ot">'a</span><span class="op">,</span> Data<span class="op">,</span> <span class="bu">Error</span><span class="op">&gt;;</span></span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="at">#[</span><span class="pp">poise::</span>command<span class="at">(</span>slash_command<span class="at">)]</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="kw">async</span> <span class="kw">fn</span> hallo(ctx<span class="op">:</span> Context<span class="op">&lt;</span><span class="ot">'_</span><span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="bu">Error</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>    ctx<span class="op">.</span>say(<span class="st">"Hallo"</span>)<span class="op">.</span><span class="kw">await</span><span class="op">?;</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="op">}</span></span>
<span id="cb5-13"><a href="#cb5-13"></a></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="at">#[</span><span class="pp">tokio::</span>main<span class="at">]</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="kw">async</span> <span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>    <span class="kw">let</span> token <span class="op">=</span> <span class="pp">std::env::</span>var(<span class="st">"DISCORD_TOKEN"</span>)<span class="op">.</span>expect(<span class="st">"missing DISCORD_TOKEN"</span>)<span class="op">;</span></span>
<span id="cb5-17"><a href="#cb5-17"></a>    <span class="kw">let</span> intents <span class="op">=</span> <span class="pp">serenity::GatewayIntents::</span>non_privileged()<span class="op">;</span></span>
<span id="cb5-18"><a href="#cb5-18"></a></span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span class="kw">let</span> framework <span class="op">=</span> <span class="pp">poise::Framework::</span>builder()</span>
<span id="cb5-20"><a href="#cb5-20"></a>    <span class="op">.</span>token(token)</span>
<span id="cb5-21"><a href="#cb5-21"></a>    <span class="op">.</span>intents(intents)</span>
<span id="cb5-22"><a href="#cb5-22"></a>    <span class="op">.</span>options(<span class="pp">poise::</span>FrameworkOptions <span class="op">{</span></span>
<span id="cb5-23"><a href="#cb5-23"></a>        commands<span class="op">:</span> <span class="pp">vec!</span>[hallo()]<span class="op">,</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>        <span class="op">..</span><span class="bu">Default</span><span class="pp">::</span><span class="kw">default</span>()</span>
<span id="cb5-25"><a href="#cb5-25"></a>    <span class="op">}</span>)</span>
<span id="cb5-26"><a href="#cb5-26"></a>    <span class="op">.</span>setup(<span class="op">|</span>ctx<span class="op">,</span> _ready<span class="op">,</span> framework<span class="op">|</span> <span class="op">{</span></span>
<span id="cb5-27"><a href="#cb5-27"></a>        <span class="dt">Box</span><span class="pp">::</span>pin(<span class="kw">async</span> <span class="kw">move</span> <span class="op">{</span></span>
<span id="cb5-28"><a href="#cb5-28"></a>            <span class="pp">poise::builtins::</span>register_globally(ctx<span class="op">,</span> <span class="op">&amp;</span>framework<span class="op">.</span>options()<span class="op">.</span>commands)<span class="op">.</span><span class="kw">await</span><span class="op">?;</span></span>
<span id="cb5-29"><a href="#cb5-29"></a>        <span class="cn">Ok</span>(Data <span class="op">{}</span>)</span>
<span id="cb5-30"><a href="#cb5-30"></a>        <span class="op">}</span>)</span>
<span id="cb5-31"><a href="#cb5-31"></a>    <span class="op">}</span>)</span>
<span id="cb5-32"><a href="#cb5-32"></a>    <span class="op">.</span>build()</span>
<span id="cb5-33"><a href="#cb5-33"></a>    <span class="op">.</span><span class="kw">await</span></span>
<span id="cb5-34"><a href="#cb5-34"></a>    <span class="op">.</span>expect(<span class="st">"Error creating framework"</span>)<span class="op">;</span></span>
<span id="cb5-35"><a href="#cb5-35"></a></span>
<span id="cb5-36"><a href="#cb5-36"></a>  </span>
<span id="cb5-37"><a href="#cb5-37"></a></span>
<span id="cb5-38"><a href="#cb5-38"></a>    <span class="cf">if</span> <span class="kw">let</span> <span class="cn">Err</span>(why) <span class="op">=</span> framework<span class="op">.</span>start()<span class="op">.</span><span class="kw">await</span> <span class="op">{</span></span>
<span id="cb5-39"><a href="#cb5-39"></a>        <span class="pp">println!</span>(<span class="st">"Client error: {:?}"</span><span class="op">,</span> why)<span class="op">;</span></span>
<span id="cb5-40"><a href="#cb5-40"></a>    <span class="op">}</span></span>
<span id="cb5-41"><a href="#cb5-41"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Voordat je gaat, zijn hier nog een aantal zaken en benodigdheden om op te letten: 1. Je moet in Discord in een app maken met intents om berichten te mogen versturen en te ontvangen. <a href="https://discord.com/developers/docs/getting-started#step-1-creating-an-app">Zie deze link voor meer informatie</a>. 2. Je hebt een Discord Token nodig in je environment variabelen. In de link bij punt 1 staat deze informatie.</p>
<p>Nu ben je in staat om met Tokio en Poise een Discord bot te maken. Leef je uit :).</p>
<p>Veel plezier.</p>
<p>Mees</p>
</section>
<section id="extra-informatie" class="level2">
<h2 class="anchored" data-anchor-id="extra-informatie">Extra informatie</h2>
<p>Om te begrijpen hoe Rust’s <code>async/.await</code> onder de moterkap werkt, <a href="https://rust-lang.github.io/async-book/02_execution/01_chapter.html">zie deze link</a>. Voor meer informatie over procedural macros, <a href="https://doc.rust-lang.org/reference/procedural-macros.html">zie deze link</a>. Discord maakt gebruikt van sharding als je bot in meer dan 2500 servers gebruikt wordt, <a href="https://discord.com/developers/docs/topics/gateway#sharding">zie deze link voor meer informatie over sharding</a>.</p>
</section>
<section id="python-decorator-en-rust-attribute-vergelijking" class="level2">
<h2 class="anchored" data-anchor-id="python-decorator-en-rust-attribute-vergelijking">Python decorator en Rust attribute vergelijking</h2>
<p>Voor mij is Python een bekendere taal en daarom gebruik ik die taal ter vergelijking. En hoewel het niet exact hetzelfde is, vind ik het handig om de Rust attribute te vergelijken met een Python decorator. Dit omdat zowel de Rust attribute als Python Decorator een bestaande functie verrijken of aanpassen. Het grote verschil is de manier waarop de functie wordt aangepast.</p>
<p>Een Python decorator is een “gewone” functie. Het argument van deze functie, is de functie die je decoreert. Bijvoorbeeld:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">def</span> print_info(func):&nbsp;</span>
<span id="cb6-2"><a href="#cb6-2"></a>    <span class="kw">def</span> wrapper(<span class="op">*</span>args, <span class="op">**</span>kwargs):&nbsp;</span>
<span id="cb6-3"><a href="#cb6-3"></a>        <span class="bu">print</span>(<span class="ss">f"Function </span><span class="sc">{</span>func<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> called with arguments </span><span class="sc">{</span>args<span class="sc">}</span><span class="ss"> and keyword arguments </span><span class="sc">{</span>kwargs<span class="sc">}</span><span class="ss">"</span>)&nbsp;</span>
<span id="cb6-4"><a href="#cb6-4"></a>        result <span class="op">=</span> func(<span class="op">*</span>args, <span class="op">**</span>kwargs)&nbsp;</span>
<span id="cb6-5"><a href="#cb6-5"></a>        <span class="bu">print</span>(<span class="ss">f"Function returned </span><span class="sc">{</span>result<span class="sc">}</span><span class="ss">"</span>)&nbsp;</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a>        <span class="cf">return</span> result&nbsp;</span>
<span id="cb6-8"><a href="#cb6-8"></a></span>
<span id="cb6-9"><a href="#cb6-9"></a>    <span class="cf">return</span> wrapper&nbsp;</span>
<span id="cb6-10"><a href="#cb6-10"></a></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="at">@print_info&nbsp;</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="kw">def</span> add(a, b):&nbsp;</span>
<span id="cb6-13"><a href="#cb6-13"></a>    <span class="cf">return</span> a <span class="op">+</span> b&nbsp;</span>
<span id="cb6-14"><a href="#cb6-14"></a></span>
<span id="cb6-15"><a href="#cb6-15"></a>add(<span class="dv">3</span>, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>De output van deze functie is:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource text number-lines code-with-copy"><code class="sourceCode"><span id="cb7-1"><a href="#cb7-1"></a>Function add called with arguments (3, 4) and keyword arguments ()</span>
<span id="cb7-2"><a href="#cb7-2"></a>Function returned 7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>https://rust-lang.github.io/async-book/01_getting_started/02_why_async.html#async-in-rust-vs-other-languages<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/cabbagemees\.nl");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="Mees-Molenaar/CabbageMees_Quarto" data-repo-id="R_kgDOIkUPOw" data-category="Blog Posts" data-category-id="DIC_kwDOIkUPO84CaIbg" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->




</body></html>